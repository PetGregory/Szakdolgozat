<div class="py-8  px-4   max-w-4xl mx-auto" (click)="closeCalendarOnClickOutside($event)">
    <div class="mb-8">
      <div class="flex justify-between items-center mb-2">
        <h1 class="text-3xl font-bold" 
         [ngClass]="{
          'text-gray-900': !darkModeService.darkMode(),
          'text-white' : darkModeService.darkMode()
        }">
          Nutrition Tracker
        </h1>
        
        <div class="relative calendar-container">
          <button (click)="calendarVisible = !calendarVisible; $event.stopPropagation()"
            class="px-4 py-2 rounded-lg font-semibold transition-colors flex items-center gap-2 hover:scale-105"
            [ngClass]="{
              'bg-black text-primary ': !darkModeService.darkMode(),
              'bg-blue-400 text-gray-900 ': darkModeService.darkMode()
            }">
            <span>{{ selectedDate === today ? 'Today' : selectedDate }}</span>
            <lucide-angular [name]="CalendarIcon" class="w-4 h-4"></lucide-angular>
          </button>
          
          <div *ngIf="calendarVisible" 
            class="absolute right-0 mt-2 z-50 p-4 rounded-lg shadow-xl calendar-container"
            (click)="$event.stopPropagation()"
            [ngClass]="{
              'bg-white border border-gray-200': !darkModeService.darkMode(),
              'bg-gray-800 border border-gray-700': darkModeService.darkMode()
            }"
            style="width: 300px;">
            <div class="flex justify-between items-center mb-4">
              <button (click)="previousMonth()" 
                class="p-2 rounded hover:bg-gray-100"
                [ngClass]="{'text-primary hover:bg-gray-700': darkModeService.darkMode(),
                
                }">
                <lucide-angular [name]="ChevronLeftIcon" class="w-5 h-5"></lucide-angular>
              </button>
              <button (click)="toggleMonthYearPicker()"
                class="px-3 py-1 rounded hover:bg-gray-100 font-semibold"
                [ngClass]="{
                  'text-gray-900 hover:bg-gray-100': !darkModeService.darkMode(),
                  'text-white hover:bg-gray-700': darkModeService.darkMode()
                }">
                {{ getMonthName() }} {{ currentYear }}
              </button>
              <button (click)="nextMonth()"
                class="p-2 rounded hover:bg-gray-100"
                [ngClass]="{'text-primary hover:bg-gray-700': darkModeService.darkMode(),

                }">
                <lucide-angular [name]="ChevronRightIcon" class="w-5 h-5"></lucide-angular>
              </button>
            </div>

            <div *ngIf="showMonthYearPicker" 
              class="mb-4 p-3 rounded-lg border"
              [ngClass]="{
                'bg-white border-gray-200': !darkModeService.darkMode(),
                'bg-gray-800 border-gray-700': darkModeService.darkMode()
              }">
              <div class="mb-3">
                <label class="block text-sm font-semibold mb-2"
                  [ngClass]="{
                    'text-gray-700': !darkModeService.darkMode(),
                    'text-gray-300': darkModeService.darkMode()
                  }">
                  Select Month
                </label>
                <div class="grid grid-cols-3 gap-2">
                  <button *ngFor="let month of getMonthNames(); let i = index"
                    (click)="selectMonth(i)"
                    class="px-3 py-2 text-sm rounded transition-colors"
                    [ngClass]="{
                      'bg-blue-600 text-white': i === currentMonth && !darkModeService.darkMode(),
                      'bg-blue-500 text-white': i === currentMonth && darkModeService.darkMode(),
                      'bg-gray-100 text-gray-700 hover:bg-gray-200': i !== currentMonth && !darkModeService.darkMode(),
                      'bg-gray-700 text-gray-300 hover:bg-gray-600': i !== currentMonth && darkModeService.darkMode()
                    }">
                    {{ month.substring(0, 3) }}
                  </button>
                </div>
              </div>
              <div>
                <label class="block text-sm font-semibold mb-2"
                  [ngClass]="{
                    'text-gray-700': !darkModeService.darkMode(),
                    'text-gray-300': darkModeService.darkMode()
                  }">
                  Select Year
                </label>
                <select [(ngModel)]="currentYear"
                  (change)="showMonthYearPicker = false"
                  class="w-full px-3 py-2 rounded border"
                  [ngClass]="{
                    'bg-white border-gray-300 text-gray-900': !darkModeService.darkMode(),
                    'bg-gray-700 border-gray-600 text-white': darkModeService.darkMode()
                  }">
                  <option *ngFor="let year of getAvailableYears()" [value]="year">
                    {{ year }}
                  </option>
                </select>
              </div>
            </div>
            
            <button (click)="goToToday()" 
              class="w-full mb-3 px-3 py-1 text-sm rounded"
              [ngClass]="{
                'bg-blue-100 text-blue-700 hover:bg-blue-200': !darkModeService.darkMode(),
                'bg-blue-900 text-blue-200 hover:bg-blue-800': darkModeService.darkMode()
              }">
              Go to Today
            </button>
            
            <div class="grid grid-cols-7 gap-1 mb-2">
              <div class="text-center text-xs font-semibold p-1"
                [ngClass]="{
                  'text-gray-600': !darkModeService.darkMode(),
                  'text-gray-400': darkModeService.darkMode()
                }">
                M
              </div>
              <div class="text-center text-xs font-semibold p-1"
                [ngClass]="{
                  'text-gray-600': !darkModeService.darkMode(),
                  'text-gray-400': darkModeService.darkMode()
                }">
                T
              </div>
              <div class="text-center text-xs font-semibold p-1"
                [ngClass]="{
                  'text-gray-600': !darkModeService.darkMode(),
                  'text-gray-400': darkModeService.darkMode()
                }">
                W
              </div>
              <div class="text-center text-xs font-semibold p-1"
                [ngClass]="{
                  'text-gray-600': !darkModeService.darkMode(),
                  'text-gray-400': darkModeService.darkMode()
                }">
                T
              </div>
              <div class="text-center text-xs font-semibold p-1"
                [ngClass]="{
                  'text-gray-600': !darkModeService.darkMode(),
                  'text-gray-400': darkModeService.darkMode()
                }">
                F
              </div>
              <div class="text-center text-xs font-semibold p-1"
                [ngClass]="{
                  'text-gray-600': !darkModeService.darkMode(),
                  'text-gray-400': darkModeService.darkMode()
                }">
                S
              </div>
              <div class="text-center text-xs font-semibold p-1"
                [ngClass]="{
                  'text-gray-600': !darkModeService.darkMode(),
                  'text-gray-400': darkModeService.darkMode()
                }">
                S
              </div>
            </div>
            
            <div class="grid grid-cols-7 gap-1">
              <button *ngFor="let day of getCalendarDays()"
                (click)="selectDate(day.date)"
                [disabled]="isFutureDate(day.date)"
                class="p-2 text-sm rounded transition-colors relative"
                [ngClass]="{
                  'text-gray-400 cursor-not-allowed opacity-50': !day.isCurrentMonth || isFutureDate(day.date),
                  'text-gray-900 hover:bg-gray-100': day.isCurrentMonth && !darkModeService.darkMode() && !isToday(day.date) && !isSelected(day.date) && !isFutureDate(day.date),
                  'text-primary hover:bg-gray-700': day.isCurrentMonth && darkModeService.darkMode() && !isToday(day.date) && !isSelected(day.date) && !isFutureDate(day.date),
                  'bg-blue-600 text-white font-bold': isToday(day.date) && !isSelected(day.date),
                  'bg-blue-500 text-white font-bold ring-2 ring-blue-300': isSelected(day.date),
                  'bg-blue-100 text-blue-700 font-bold': isToday(day.date) && !isSelected(day.date) && !darkModeService.darkMode()
                }">
                {{ day.day }}
                <span *ngIf="hasEntries(day.date) && day.isCurrentMonth" 
                  class="absolute bottom-1 left-1/2 transform -translate-x-1/2 w-1 h-1 rounded-full"
                  [ngClass]="{
                    'bg-blue-600': !isSelected(day.date) && !isToday(day.date),
                    'bg-white': isSelected(day.date) || (isToday(day.date) && darkModeService.darkMode()),
                    'bg-blue-800': isToday(day.date) && !darkModeService.darkMode() && !isSelected(day.date)
                  }">
                </span>
              </button>
            </div>
          </div>
        </div>
      </div>
   
      <p class="text-sm" 
         [ngClass]="{
           'text-gray-600': !darkModeService.darkMode(),
           'text-gray-300': darkModeService.darkMode()
         }"> Search for foods and track your daily calorie intake </p>
    </div>
   
    <div *ngIf="user?.calorieTarget" 
         class="mb-6 p-6 rounded-lg"
         [ngClass]="{
          'bg-blue-50 border-2 border-blue-200': !darkModeService.darkMode(),
          'bg-blue-900 border-2 border-blue-700': darkModeService.darkMode()
         }">
      
      <div class="flex justify-between items-center mb-2">
         <div class="text-lg font-semibold" [ngClass]="{
             'text-blue-900': !darkModeService.darkMode(),
             'text-blue-100': darkModeService.darkMode()
           }">Daily Calorie Progress</div>
         
         <div class="text-2xl font-bold" 
              [ngClass]="{
                'text-blue-600': !darkModeService.darkMode(),
                'text-blue-300': darkModeService.darkMode()
              }">
              {{ totalCaloriesToday }} / {{ user.calorieTarget }} kcal
         </div>
      </div>
   
      <div class="w-full bg-gray-200 rounded-full h-4 mb-2"
           [ngClass]="{'bg-gray-700': darkModeService.darkMode()}">
         <div class="h-4 rounded-full transition-all duration-300"
              [ngClass]="{
                'bg-blue-600': getProgressPercentage() <= 100,
                'bg-red-600': getProgressPercentage() > 100
              }"
              [style.width.%]="getProgressPercentage()"></div>
      </div>
   
      <div class="text-sm" [ngClass]="{
           'text-blue-700': !darkModeService.darkMode(),
           'text-blue-200': darkModeService.darkMode()
         }">
         <span *ngIf="getRemainingCalories() >= 0">
            {{ getRemainingCalories() }} kcal remaining
         </span>
         <span *ngIf="getRemainingCalories() < 0" 
               class="text-red-600 dark:text-red-400">
            {{ Math.abs(getRemainingCalories()) }} kcal over target
         </span>
      </div>
    </div>
   
    <div class="mb-6 p-6 rounded-lg"
         [ngClass]="{
           'bg-white shadow-lg': !darkModeService.darkMode(),
           'bg-gray-800': darkModeService.darkMode()
         }">
         
         <h2 class="text-xl font-semibold mb-4"
           [ngClass]="{
             'text-gray-900': !darkModeService.darkMode(),
             'text-white': darkModeService.darkMode()
           }"> Search Food </h2>
         
         <div class="flex gap-2 mb-4">
           <input type="text"
             [(ngModel)]="searchQuery"
             (keyup.enter)="searchFood()"
             placeholder="Search for food..."
             class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2"
             [ngClass]="{
               'border-gray-300 bg-white': !darkModeService.darkMode(),
               'border-gray-600 bg-gray-700 text-white': darkModeService.darkMode()
             }" />
   
           <button (click)="searchFood()"
             [disabled]="isLoading || !searchQuery.trim()"
             class="px-6 py-2 rounded-lg font-semibold transition-colors disabled:opacity-50 hover:scale-105"
             [ngClass]="{
              'bg-black text-primary ': !darkModeService.darkMode(),
              'bg-blue-400 text-gray-900 ': darkModeService.darkMode()
            }">
               <span *ngIf="!isLoading" 
               >Search</span>
               <span *ngIf="isLoading">Searching...</span>
           </button>
         </div>
   
         <div *ngIf="searchResults.length > 0" class="space-y-2 mb-4">
           <div *ngFor="let food of searchResults"
             (click)="selectFood(food)"
             class="p-4 border rounded-lg cursor-pointer transition-all hover:scale-105"
             [ngClass]="{
               'border-gray-200 hover:border-blue-500': !darkModeService.darkMode() && selectedFood?.name !== food.name,
               'border-blue-500 bg-blue-50': !darkModeService.darkMode() && selectedFood?.name === food.name,
               'border-gray-600 hover:border-blue-400': darkModeService.darkMode() && selectedFood?.name !== food.name,
               'border-blue-400 bg-blue-900': darkModeService.darkMode() && selectedFood?.name === food.name
             }">
               <div class="font-semibold" 
                 [ngClass]="{
                   'text-gray-900': !darkModeService.darkMode(),
                   'text-white': darkModeService.darkMode()
                 }">{{ food.name }}</div>
               <div class="text-sm mt-1"
                 [ngClass]="{
                   'text-gray-600': !darkModeService.darkMode(),
                   'text-gray-300': darkModeService.darkMode()
                 }">{{ food.calories }} kcal per {{ food.serving_size_g }}g</div>
           </div>
         </div>
   
         <div *ngIf="selectedFood" class="mt-4 p-4 border rounded-lg"
           [ngClass]="{
             'border-blue-200 bg-blue-50': !darkModeService.darkMode(),
             'border-blue-700 bg-blue-900': darkModeService.darkMode()
           }">
           <div class="font-semibold mb-2"
             [ngClass]="{
               'text-blue-900': !darkModeService.darkMode(),
               'text-blue-100': darkModeService.darkMode()
             }">Add {{ selectedFood.name }}</div>
   
           <div class="flex gap-2 items-end">
             <div class="flex-1">
               <label class="block text-sm mb-1"
                 [ngClass]="{
                   'text-gray-700': !darkModeService.darkMode(),
                   'text-gray-300': darkModeService.darkMode()
                 }">Amount (grams)</label>
               <input type="number"
                 [(ngModel)]="amountInGrams"
                 min="1"
                 class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2"
                 [ngClass]="{
                   'border-gray-300 bg-white': !darkModeService.darkMode(),
                   'border-gray-600 bg-gray-700 text-white': darkModeService.darkMode()
                 }" />
             </div>
   
             <div class="text-sm font-semibold"
               [ngClass]="{
                 'text-blue-700': !darkModeService.darkMode(),
                 'text-blue-200': darkModeService.darkMode()
               }">
                 = {{ getCalculatedCalories() }} kcal
             </div>
   
             <button (click)="addFood()"
               class="px-6 py-2 rounded-lg font-semibold transition-colors"
               [ngClass]="{
                 'bg-green-600 text-white hover:bg-green-700': !darkModeService.darkMode(),
                 'bg-green-500 text-white hover:bg-green-600': darkModeService.darkMode()
               }">Add</button>
           </div>
         </div>
     </div>
   
     <div class="p-6 rounded-lg"
          [ngClass]="{
            'bg-white shadow-lg': !darkModeService.darkMode(),
            'bg-gray-800': darkModeService.darkMode()
          }">
         <h2 class="text-xl font-semibold mb-4"
           [ngClass]="{
             'text-gray-900': !darkModeService.darkMode(),
             'text-white': darkModeService.darkMode()
           }">
           {{ selectedDate === today ? "Today's" : "Selected Date's" }} Food Entries
           <span class="text-sm font-normal ml-2"
             [ngClass]="{
               'text-gray-600': !darkModeService.darkMode(),
               'text-gray-400': darkModeService.darkMode()
             }">
             ({{ selectedDate }})
           </span>
         </h2>
   
         <div *ngIf="todayEntries.length === 0"
              class="text-center py-8"
              [ngClass]="{
                'text-gray-500': !darkModeService.darkMode(),
                'text-gray-400': darkModeService.darkMode()
              }">
              No food entries for {{ selectedDate === today ? 'today' : 'this date' }}. Start tracking your meals!
         </div>
   
         <div *ngIf="todayEntries.length > 0" class="space-y-3">
           <div *ngFor="let entry of todayEntries"
             class="p-4 border rounded-lg flex justify-between items-center"
             [ngClass]="{
               'border-gray-200 bg-gray-50': !darkModeService.darkMode(),
               'border-gray-600 bg-gray-700': darkModeService.darkMode()
             }">
               <div class="flex-1">
                 <div class="font-semibold"
                   [ngClass]="{
                     'text-gray-900': !darkModeService.darkMode(),
                     'text-white': darkModeService.darkMode()
                   }">{{ entry.name }}</div>
                 <div class="text-sm mt-1"
                   [ngClass]="{
                     'text-gray-600': !darkModeService.darkMode(),
                     'text-gray-300': darkModeService.darkMode()
                   }">
                   {{ entry.amount }}g • {{ entry.calories }} kcal • {{ entry.protein }}g protein
                 </div>
               </div>
   
               <button (click)="removeFoodEntry(entry.id)"
                 class="ml-4 px-4 py-2 rounded-lg font-semibold transition-colors hover:scale-105 "
                 [ngClass]="{
                   'bg-red-200 text-red-700 hover:bg-red-300': !darkModeService.darkMode(),
                   'bg-red-900 text-bg-gray-300': darkModeService.darkMode()
                 }">Remove</button>
           </div>
         </div>
     </div>
   </div>
   